<!DOCTYPE html>
<html>
<head>
    <title>Test Firebase Simple</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBYvIGN0-Yd1b7LG2Seg6VwfKnTYIo4n_4",
            authDomain: "shotanalisys.firebaseapp.com",
            projectId: "shotanalisys",
            storageBucket: "shotanalisys.firebasestorage.app",
            messagingSenderId: "602998191800",
            appId: "1:602998191800:web:dd8a758d589b12b3c5264d"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        window.testConnection = async function() {
            console.log('Probando conexión a Firebase Storage...');
            try {
                // Crear un archivo de prueba pequeño
                const testContent = 'Test file content';
                const blob = new Blob([testContent], { type: 'text/plain' });
                
                const storageRef = ref(storage, `test/connection-test-${Date.now()}.txt`);
                const uploadTask = uploadBytesResumable(storageRef, blob);

                uploadTask.on('state_changed', 
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        console.log('Progreso:', progress + '%');
                        document.getElementById('status').textContent = `Progreso: ${progress.toFixed(1)}%`;
                    },
                    (error) => {
                        console.error('Error:', error);
                        document.getElementById('status').textContent = 'Error: ' + error.message;
                    },
                    async () => {
                        try {
                            const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                            console.log('✅ Conexión exitosa:', downloadURL);
                            document.getElementById('status').textContent = '✅ Conexión exitosa!';
                        } catch (error) {
                            console.error('Error obteniendo URL:', error);
                            document.getElementById('status').textContent = 'Error obteniendo URL: ' + error.message;
                        }
                    }
                );
            } catch (error) {
                console.error('Error general:', error);
                document.getElementById('status').textContent = 'Error general: ' + error.message;
            }
        };
    </script>
</head>
<body>
    <h1>Test Firebase Storage Connection</h1>
    <button onclick="testConnection()">Probar Conexión</button>
    <div id="status">Esperando...</div>
    <div id="console" style="background: #f0f0f0; padding: 10px; margin-top: 10px; font-family: monospace; white-space: pre-wrap;"></div>
    
    <script>
        // Capturar logs de consola
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            document.getElementById('console').textContent += args.join(' ') + '\n';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            document.getElementById('console').textContent += 'ERROR: ' + args.join(' ') + '\n';
        };
    </script>
</body>
</html>

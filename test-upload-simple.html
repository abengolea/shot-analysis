<!DOCTYPE html>
<html>
<head>
    <title>Test Upload Simple</title>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getStorage, ref, uploadBytesResumable, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBYvIGN0-Yd1b7LG2Seg6VwfKnTYIo4n_4",
            authDomain: "shotanalisys.firebaseapp.com",
            projectId: "shotanalisys",
            storageBucket: "shotanalisys.firebasestorage.app",
            messagingSenderId: "602998191800",
            appId: "1:602998191800:web:dd8a758d589b12b3c5264d"
        };

        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        window.testUpload = async function() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Selecciona un archivo');
                return;
            }

            console.log('Iniciando test de upload...', file.name, file.size);
            
            const storageRef = ref(storage, `test/${Date.now()}_${file.name}`);
            const uploadTask = uploadBytesResumable(storageRef, file);

            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Progreso:', progress + '%');
                    document.getElementById('progress').textContent = progress.toFixed(1) + '%';
                },
                (error) => {
                    console.error('Error:', error);
                    document.getElementById('status').textContent = 'Error: ' + error.message;
                },
                async () => {
                    try {
                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                        console.log('Upload completado:', downloadURL);
                        document.getElementById('status').textContent = 'Completado: ' + downloadURL;
                    } catch (error) {
                        console.error('Error obteniendo URL:', error);
                        document.getElementById('status').textContent = 'Error obteniendo URL: ' + error.message;
                    }
                }
            );
        };
    </script>
</head>
<body>
    <h1>Test Upload Firebase Storage</h1>
    <input type="file" id="fileInput" accept="video/*">
    <button onclick="testUpload()">Test Upload</button>
    <div id="progress">0%</div>
    <div id="status">Esperando...</div>
</body>
</html>